---
import Layout from '~/layouts/PageLayout.astro';
import { Image } from 'astro:assets';

const metadata = {
  title: 'Astrology Quiz - Discover Your Zodiac Sign',
  description: 'Take our mystical astrology quiz to discover your true zodiac sign through the alignment of the stars.',
  canonical: '/astrology-quiz'
};
---

<Layout metadata={metadata}>
  <div class="min-h-screen bg-dark relative overflow-hidden">
    <!-- Background with night sky -->
    <div class="absolute inset-0">
      <div class="absolute inset-0 bg-gradient-to-b from-primary to-dark opacity-90"></div>
      <div class="absolute inset-0 opacity-55" style="background-image: url('/assets/images/night-sky.webp'); background-size: cover; background-position: center;"></div>
      <!-- Animated background stars -->
      <div class="absolute inset-0">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
      </div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8">
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 animate-fade-in">
          <h1 class="text-4xl md:text-6xl font-normal tracking-tight text-gray-200 mb-3 font-heading">
            ✨ Astrology Quiz ✨
          </h1>
          <p class="text-xl bg-gradient-to-r from-secondary via-primary to-primary bg-clip-text text-transparent">
            Discover your true zodiac sign through the mystical alignment of the stars
          </p>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="bg-page/20 backdrop-blur-lg rounded-2xl p-6 md:p-8 shadow-2xl border border-gray-500/20 animate-slide-up">
          <!-- Step 1: Email Capture -->
          <div id="step-1" class="quiz-step active">
            <div class="text-center mb-6">
              <h2 class="text-2xl font-normal tracking-tight text-gray-200 mb-2 font-heading">Get Your Sacred Flower Reading</h2>
              <p class="text-muted">Enter your email to receive your personalized flower reading and cosmic insights</p>
            </div>

            <div class="max-w-sm mx-auto">
              <div class="mb-6">
                <label for="email-input" class="block text-gray-200 text-base font-medium mb-2">Email Address</label>
                <input 
                  type="email" 
                  id="email-input" 
                  class="w-full px-4 py-3 bg-white/10 border border-gray-500/30 rounded-lg text-white text-base focus:outline-none focus:ring-4 focus:ring-primary/50 transition-all duration-300 backdrop-blur-sm placeholder-white/70"
                  placeholder="Enter your email address"
                >
              </div>

              <button 
                id="email-next-btn" 
                class="btn-primary w-full font-semibold py-3 px-6 rounded-lg text-base transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                Continue to Quiz ✨
              </button>
            </div>
          </div>

          <!-- Step 2: Birth Date Input -->
          <div id="step-2" class="quiz-step hidden">
            <div class="text-center mb-6">
              <h2 class="text-2xl font-normal tracking-tight text-gray-200 mb-2 font-heading">When were you born?</h2>
              <p class="text-muted">Enter your birth date to reveal your zodiac sign</p>
            </div>

            <div class="max-w-sm mx-auto">
              <div class="mb-6">
                <label for="birth-date" class="block text-gray-200 text-base font-medium mb-2">Birth Date</label>
                <input 
                  type="date" 
                  id="birth-date" 
                  class="w-full px-4 py-3 bg-white/10 border border-gray-500/30 rounded-lg text-white text-base focus:outline-none focus:ring-4 focus:ring-primary/50 transition-all duration-300 backdrop-blur-sm placeholder-white/70"
                  placeholder="Select your birth date"
                >
              </div>

              <button 
                id="next-btn" 
                class="btn-primary w-full font-semibold py-3 px-6 rounded-lg text-base transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                Discover My Sign ✨
              </button>
            </div>
          </div>

          <!-- Step 3: Loading Animation -->
          <div id="step-3" class="quiz-step hidden">
            <div class="text-center">
              <div class="w-24 h-24 mx-auto mb-6">
                <div class="zodiac-wheel animate-spin-slow"></div>
              </div>
              <h2 class="text-2xl font-normal tracking-tight text-gray-200 mb-3 font-heading">Reading the stars...</h2>
              <p class="text-muted">Aligning your cosmic energy with the universe</p>
            </div>
          </div>

          <!-- Step 4: Result -->
          <div id="step-4" class="quiz-step hidden">
            <div class="text-center">
              <!-- Flower Section -->
              <div class="bg-page/20 backdrop-blur-sm rounded-xl p-6 border border-gray-500/20">
                <h3 class="text-xl font-normal tracking-tight text-gray-200 mb-4 font-heading">🌸 Your Sacred Flower</h3>
                <div id="flower-info" class="text-muted"></div>
              </div>

              <div class="flex flex-col sm:flex-row gap-3 justify-center mt-6">
                <button 
                  id="restart-btn" 
                  class="btn-secondary font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105"
                >
                  Take Quiz Again
                </button>
                <button 
                  id="share-btn" 
                  class="btn-primary font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105"
                >
                  Share Result
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Animated Stars Background */
    .stars {
      position: absolute;
      width: 1px;
      height: 1px;
      background: transparent;
      box-shadow: 
        1744px 122px #fff,
        134px 1321px #fff,
        1626px 1566px #fff,
        1823px 1966px #fff,
        1178px 1988px #fff,
        1994px 1998px #fff,
        1998px 1999px #fff,
        2000px 2000px #fff;
      animation: animateStars 50s linear infinite;
    }

    .stars2 {
      position: absolute;
      width: 2px;
      height: 2px;
      background: transparent;
      box-shadow: 
        1744px 122px #fff,
        134px 1321px #fff,
        1626px 1566px #fff,
        1823px 1966px #fff,
        1178px 1988px #fff,
        1994px 1998px #fff,
        1998px 1999px #fff,
        2000px 2000px #fff;
      animation: animateStars 100s linear infinite;
    }

    .stars3 {
      position: absolute;
      width: 3px;
      height: 3px;
      background: transparent;
      box-shadow: 
        1744px 122px #fff,
        134px 1321px #fff,
        1626px 1566px #fff,
        1823px 1966px #fff,
        1178px 1988px #fff,
        1994px 1998px #fff,
        1998px 1999px #fff,
        2000px 2000px #fff;
      animation: animateStars 150s linear infinite;
    }

    @keyframes animateStars {
      from {
        transform: translateY(0px);
      }
      to {
        transform: translateY(-2000px);
      }
    }

    /* Zodiac Wheel Animation */
    .zodiac-wheel {
      width: 100%;
      height: 100%;
      border: 4px solid transparent;
      border-top: 4px solid var(--aw-color-secondary);
      border-right: 4px solid var(--aw-color-primary);
      border-bottom: 4px solid var(--aw-color-accent);
      border-left: 4px solid var(--ptm-dark-green);
      border-radius: 50%;
      animation: spin 3s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .animate-spin-slow {
      animation: spin 3s linear infinite;
    }

    /* Quiz Step Transitions */
    .quiz-step {
      transition: all 0.5s ease-in-out;
    }

    .quiz-step.hidden {
      opacity: 0;
      transform: translateY(20px);
      display: none;
    }

    .quiz-step.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* Custom Animations */
    .animate-fade-in {
      animation: fadeIn 1s ease-out;
    }

    .animate-slide-up {
      animation: slideUp 0.8s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0; 
        transform: translateY(30px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      h1 {
        font-size: 2.5rem;
      }
    }

    /* Flower image styling */
    .flower-image {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
  </style>

  <script>
    // Zodiac data with flowers
    const zodiacSigns = {
      'aries': {
        name: 'Aries',
        icon: '♈',
        dates: 'March 21 - April 19',
        flower: {
          name: 'Honeysuckle',
          image: 'https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=400&h=400&fit=crop&crop=center',
          reason: 'Like the honeysuckle that blooms early in spring, Aries represents <strong>new beginnings</strong> and the <strong>courage to be the first to bloom</strong>. The flower\'s sweet fragrance and <strong>vibrant energy</strong> mirror Aries\' <strong>bold and passionate nature</strong>.'
        }
      },
      'taurus': {
        name: 'Taurus',
        icon: '♉',
        dates: 'April 20 - May 20',
        flower: {
          name: 'Rose',
          image: 'https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400&h=400&fit=crop&crop=center',
          reason: 'The rose symbolizes Taurus\' love for <strong>beauty and luxury</strong>. Like the rose that takes time to bloom but creates the most stunning display, Taurus is <strong>patient and steady</strong>, building <strong>lasting relationships</strong> and creating beautiful, stable foundations.'
        }
      },
      'gemini': {
        name: 'Gemini',
        icon: '♊',
        dates: 'May 21 - June 20',
        flower: {
          name: 'Lavender',
          image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop&crop=center',
          reason: 'Lavender represents Gemini\'s <strong>dual nature</strong> and <strong>intellectual curiosity</strong>. The flower\'s calming scent and healing properties reflect Gemini\'s ability to <strong>communicate and connect</strong> with others, while its <strong>versatility</strong> mirrors Gemini\'s <strong>adaptable personality</strong>.'
        }
      },
      'cancer': {
        name: 'Cancer',
        icon: '♋',
        dates: 'June 21 - July 22',
        flower: {
          name: 'White Lily',
          image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=400&fit=crop&crop=center',
          reason: 'The white lily represents Cancer\'s <strong>pure, nurturing heart</strong> and <strong>protective nature</strong>. Like the lily that grows in water and symbolizes motherhood, Cancer is deeply connected to <strong>home, family, and emotional security</strong>, offering <strong>unconditional love and care</strong>.'
        }
      },
      'leo': {
        name: 'Leo',
        icon: '♌',
        dates: 'July 23 - August 22',
        flower: {
          name: 'Sunflower',
          image: 'https://images.unsplash.com/photo-1597848212624-a19eb35e2651?w=400&h=400&fit=crop&crop=center',
          reason: 'The sunflower perfectly represents Leo\'s <strong>sunny disposition</strong> and <strong>natural leadership</strong>. Like the sunflower that always faces the sun and stands tall and proud, Leo radiates <strong>warmth, creativity, and confidence</strong>, drawing others to their <strong>magnetic personality</strong>.'
        }
      },
      'virgo': {
        name: 'Virgo',
        icon: '♍',
        dates: 'August 23 - September 22',
        flower: {
          name: 'Chrysanthemum',
          image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=400&fit=crop&crop=center',
          reason: 'The chrysanthemum symbolizes Virgo\'s <strong>attention to detail</strong> and <strong>practical wisdom</strong>. Like this flower that blooms in autumn and represents perfection and longevity, Virgo is <strong>methodical, reliable</strong>, and creates beauty through <strong>careful planning and hard work</strong>.'
        }
      },
      'libra': {
        name: 'Libra',
        icon: '♎',
        dates: 'September 23 - October 22',
        flower: {
          name: 'Pink Rose',
          image: 'https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400&h=400&fit=crop&crop=center',
          reason: 'The pink rose represents Libra\'s love for <strong>harmony, beauty, and relationships</strong>. Like the rose that symbolizes love and balance, Libra seeks to create <strong>peace and beauty</strong> in all aspects of life, valuing <strong>fairness</strong> and maintaining <strong>harmonious connections</strong>.'
        }
      },
      'scorpio': {
        name: 'Scorpio',
        icon: '♏',
        dates: 'October 23 - November 21',
        flower: {
          name: 'Dark Orchid',
          image: 'https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400&h=400&fit=crop&crop=center',
          reason: 'The dark orchid represents Scorpio\'s <strong>mysterious and intense nature</strong>. Like the orchid that grows in hidden places and has deep, complex beauty, Scorpio possesses <strong>profound emotional depth, magnetic attraction</strong>, and <strong>transformative power</strong>.'
        }
      },
      'sagittarius': {
        name: 'Sagittarius',
        icon: '♐',
        dates: 'November 22 - December 21',
        flower: {
          name: 'Carnation',
          image: 'https://plus.unsplash.com/premium_photo-1677178629088-ba7d3a23049a?q=80&w=987&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D?w=400&h=400&fit=crop&crop=center',
          reason: 'The carnation represents Sagittarius\' <strong>adventurous spirit</strong> and <strong>optimistic outlook</strong>. Like the carnation that comes in many colors and symbolizes fascination and distinction, Sagittarius is <strong>curious, philosophical</strong>, and always seeking <strong>new experiences and knowledge</strong>.'
        }
      },
      'capricorn': {
        name: 'Capricorn',
        icon: '♑',
        dates: 'December 22 - January 19',
        flower: {
          name: 'Ivy',
          image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=400&fit=crop&crop=center',
          reason: 'Ivy represents Capricorn\'s <strong>determination</strong> and ability to <strong>climb to great heights</strong>. Like ivy that grows steadily and persistently, Capricorn is <strong>ambitious, disciplined</strong>, and builds <strong>lasting success</strong> through <strong>patience and hard work</strong>.'
        }
      },
      'aquarius': {
        name: 'Aquarius',
        icon: '♒',
        dates: 'January 20 - February 18',
        flower: {
          name: 'Orchid',
          image: 'https://images.unsplash.com/photo-1562690868-60bbe7293e94?w=400&h=400&fit=crop&crop=center',
          reason: 'The orchid represents Aquarius\' <strong>unique and innovative nature</strong>. Like the orchid that is rare and distinctive, Aquarius is <strong>original, independent</strong>, and <strong>ahead of their time</strong>, bringing <strong>new ideas and humanitarian values</strong> to the world.'
        }
      },
      'pisces': {
        name: 'Pisces',
        icon: '♓',
        dates: 'February 19 - March 20',
        flower: {
          name: 'Water Lily',
          image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=400&fit=crop&crop=center',
          reason: 'The water lily represents Pisces\' <strong>dreamy and intuitive nature</strong>. Like the water lily that floats on water and connects the spiritual and physical worlds, Pisces is <strong>deeply intuitive, artistic</strong>, and has a natural connection to the <strong>mystical and creative realms</strong>.'
        }
      }
    };

    // Get zodiac sign based on birth date
    function getZodiacSign(month: number, day: number): string {
      if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return 'aries';
      if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return 'taurus';
      if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return 'gemini';
      if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return 'cancer';
      if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return 'leo';
      if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return 'virgo';
      if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return 'libra';
      if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) return 'scorpio';
      if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) return 'sagittarius';
      if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return 'capricorn';
      if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return 'aquarius';
      if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return 'pisces';
      return 'aries'; // fallback
    }

    // Quiz functionality
    document.addEventListener('DOMContentLoaded', function() {
      const birthDateInput = document.getElementById('birth-date') as HTMLInputElement;
      const nextBtn = document.getElementById('next-btn') as HTMLButtonElement;
      const restartBtn = document.getElementById('restart-btn') as HTMLButtonElement;
      const shareBtn = document.getElementById('share-btn') as HTMLButtonElement;
      const emailInput = document.getElementById('email-input') as HTMLInputElement;
      const emailNextBtn = document.getElementById('email-next-btn') as HTMLButtonElement;

      if (!birthDateInput || !nextBtn || !restartBtn || !shareBtn || !emailInput || !emailNextBtn) {
        console.error('Required elements not found');
        return;
      }

      // Enable/disable next button based on date input
      birthDateInput.addEventListener('change', function() {
        nextBtn.disabled = !this.value;
      });

      // Enable/disable email next button based on email input
      emailInput.addEventListener('input', function() {
        emailNextBtn.disabled = !this.value;
      });

      // Email next button click handler
      emailNextBtn.addEventListener('click', function() {
        // In a real application, you would send the email to your backend
        // For now, we'll just show the birth date step
        showStep(2);
      });

      // Next button click handler
      nextBtn.addEventListener('click', function() {
        const birthDate = new Date(birthDateInput.value);
        const month = birthDate.getMonth() + 1;
        const day = birthDate.getDate();
        
        const zodiacKey = getZodiacSign(month, day);
        const zodiacData = zodiacSigns[zodiacKey as keyof typeof zodiacSigns];

        // Show loading step
        showStep(3);

        // Simulate loading time
        setTimeout(() => {
          // Display flower information with image
          const flowerInfo = document.getElementById('flower-info');

          if (flowerInfo) {
            // Display flower section
            flowerInfo.innerHTML = `
              <div class="text-center mb-4">
                <img src="${zodiacData.flower.image}" alt="${zodiacData.flower.name}" class="flower-image mx-auto mb-4">
                <h4 class="text-lg font-medium text-gray-200 mb-3">${zodiacData.flower.name}</h4>
              </div>
              <p class="text-sm leading-relaxed text-center">${zodiacData.flower.reason}</p>
            `;
          }

          showStep(4);
        }, 3000);
      });

      // Restart button click handler
      restartBtn.addEventListener('click', function() {
        birthDateInput.value = '';
        emailInput.value = '';
        nextBtn.disabled = true;
        emailNextBtn.disabled = true;
        showStep(1);
      });

      // Share button click handler
      shareBtn.addEventListener('click', function() {
        const flowerName = document.querySelector('#flower-info h4');
        
        if (flowerName) {
          const nameText = flowerName.textContent || '';
          
          if (navigator.share) {
            navigator.share({
              title: 'My Sacred Flower',
              text: `I just discovered my sacred flower is the ${nameText}! Take the astrology quiz to find your flower too!`,
              url: window.location.href
            });
          } else {
            // Fallback: copy to clipboard
            const text = `I just discovered my sacred flower is the ${nameText}! Take the astrology quiz to find your flower too! ${window.location.href}`;
            navigator.clipboard.writeText(text).then(() => {
              alert('Result copied to clipboard!');
            });
          }
        }
      });

      function showStep(stepNumber: number) {
        // Hide all steps
        document.querySelectorAll('.quiz-step').forEach(step => {
          step.classList.add('hidden');
          step.classList.remove('active');
        });

        // Show target step
        const targetStep = document.getElementById(`step-${stepNumber}`);
        if (targetStep) {
          targetStep.classList.remove('hidden');
          targetStep.classList.add('active');
        }
      }
    });
  </script>
</Layout> 